<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>模块</title>
	<script src="plugins/vue.js" type="text/javascript"></script>
	
	<link href="default.css" rel="stylesheet" type="text/css" /> 
	<script src="plugins/globalUI.js" type="text/javascript"></script>
</head>
<body>
模块
</body>

<script>

var DataProxy = function(name, vueObj, fileNameSuf){
	this.fileNameSuf = fileNameSuf ? fileNameSuf : "文件";
	this.name;
	this.vueObj;
	this.data = {
		list:[]
	};
};

DataProxy.prototype.removeRecord = function(index){
	
	this.resetView();
};

DataProxy.prototype.appendRecord = function(record){
	this.getMainList().splice(0, record, 1);
	this.resetView();
};

DataProxy.prototype.getViewerDataModel = function(){
	
};

/**
 * 替换显示的数据
 */
DataProxy.prototype.replaceViewerDataModel = function(data){};

/**
 * 获取显示的数据的过滤条件
 */
DataProxy.prototype.getViewerCondition = function(){};

DataProxy.prototype.resetView = function(){
	var filterData = this.filter();
	this.replaceViewerDataModel(filterData);
};

DataProxy.prototype.filter = function(){
	var that = this;
	var list = this.getMainList();
	var condition = this.getViewerCondition();
	var filterData = list.find(function(record){
		return that.checkRecord(record, condition);
	});
	return filterData;
};

//
DataProxy.prototype.checkRecord = function(record, condition){
	return true;
};

DataProxy.prototype.clearData = function(){
	
	this.resetView();
};

DataProxy.prototype.getData = function(){
	return this.data;
};

DataProxy.prototype.setData = function(dataJson){
	this.data = dataJson;
	this.resetView();
};

DataProxy.prototype.open = function(){
	var that = this;
	var input = document.createElement("input");
	input.type="file";
	input.addEventListener("change", function(){
		var file = input.files[0];
		var reader = new FileReader();
		reader.onload = function(){
			var dataJson = JSON.parse(this.result);
			that.setData(dataJson);
		};
		reader.readAsText(file);
	});
	input.click();
};

DataProxy.prototype.save = function(){
	var dataStr = JSON.parse(this.data);
	var dataURL = window.URL.createObjectURL(new Blob([dataStr]));
	
	var a = document.createElement("a");
	a.download = this.fileNameSuf + "_" + this.currentTimeStr() + ".json";
	a.href = dataURL;
	
	a.click();
};

DataProxy.prototype.currentTimeStr = function(){
	return new Date().toJSONString();
};

DataProxy.prototype.getMainList = function(){
	return this.data.list;
};

</script>

</html>
