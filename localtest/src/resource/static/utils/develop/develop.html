<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>开发</title>
		
	<script src="plugins/vue.js" type="text/javascript"></script>
		
	<link href="default.css" rel="stylesheet" type="text/css" /> 
	<script src="plugins/globalUI.js" type="text/javascript"></script>
</head>

<body>
	<div id="develop-page" class="page-body">
		<div style="position:relative;font-size:0px;">
			<a v-for="(item,i) in pages" @click="tabPanel(item.name)" href="javascript:void(0);" :class="{'button-down':item.frameShow}" class="button button-tab-header">{{item.title}}</a>
			<div style="position:absolute;right:10px;top:0px;">
				<a @click="reloadCurrPage" class="a-simple-button" href="javascript:void(0);">⊙</a>
			</div>
		</div>
		
		<div style="height:calc(100% - 32px);">
			<p v-for="item in pages" v-show="item.frameShow" style="height:100%;">
				<iframe :src="item.url" style="width:100%;height:100%;"></iframe>
			</p>
		</div>
		
	</div>
	
</body>

<script>
	var pages = [{
		name:"记录",
		frameShow:false,
		title:"记录",
		url:"job.html"
	},{
		name:"database",
		frameShow:false,
		title:"表清单",
		url:"database.html"
	},{
		name:"work",
		frameShow:false,
		title:"工作",
		url:"work.html"
	},{
		name:"修改",
		frameShow:false,
		title:"修改",
		url:"update.html"
	},{
		name:"API",
		frameShow:false,
		title:"API",
		url:"api.html"
	},{
		name:"页面",
		frameShow:true,
		title:"页面",
		url:"page.html"
	},{
		name:"菜单",
		frameShow:false,
		title:"菜单",
		url:"menu.html"
	},{
		name:"功能",
		frameShow:false,
		title:"功能",
		url:"model.html"
	}];

	var developPageVue = new Vue({
		el: "#develop-page",
		data:{
			pages:pages
		},
		methods:{
			reloadCurrPage:function(){
				developPageUI.reloadCurrPage();
			},
			tabPanel:function(name, opt){
				developPageUI.tabPanel(name);
			}
		}
	});
	
	var developPageUI = (function(){
		var obj = Object.create(null);
		
		obj.reloadCurrPage = function(){
			var currPage = this.currPage();
			if(currPage){
				var url = currPage.url;
				currPage.url = "...";
				developPageVue.$nextTick(function(){
					currPage.url = url;
				});
			}
		};
		
		obj.tabPanel = function(name){
			if(!name)
				return;
			pages.forEach(item => {
				item.frameShow = false;
				if(item.name == name){
					item.frameShow = true;
				}
			});
		};
		
		obj.currPage = function(){
			var currPage = null;
			currPage = pages.find(item => {
				if(item.frameShow == true){
					return true;
				}
				return false;
			});
			return currPage;
		};
		
		obj.toggle = function(name, params){
			this.tabPanel(name);
		};
		
		return obj;
	})();
	
	setInterval(function(){
		var parentDoScript = localStorage.getItem("parentDoScript");
		if(parentDoScript){
			var params = JSON.parse(parentDoScript);
			developPageUI.toggle(params.pageName, params.opt);
			localStorage.removeItem("parentDoScript");
		}
	}, 500);
	
</script>


</html>
